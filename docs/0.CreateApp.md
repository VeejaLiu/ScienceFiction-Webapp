# 创建这个APP
## 1. 技术栈选择
- Node 16.16.0
- Npm 8.11.0
- Babel
- Webpack


> 一组 JavaScript 构建工具链通常由这些组成：
> - 一个 package 管理器，比如 Yarn 或 npm。它能让你充分利用庞大的第三方 package 的生态系统，并且轻松地安装或更新它们。
> - 一个打包器，比如 webpack 或 Parcel。它能让你编写模块化代码，并将它们组合在一起成为小的 package，以优化加载时间。
> - 一个编译器，例如 Babel。它能让你编写的新版本 JavaScript 代码，在旧版浏览器中依然能够工作。


## 2. 创建
运行指令进行初始化，并且创建src和public文件夹:
```shell
npm init
mkdir src
mkdir public
```
创建index.html在public文件夹中:
```html
<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>React Starter</title>
</head>

<body>
<div id="root"></div>
<noscript>
    You need to enable JavaScript to run this app.
</noscript>
<script src="../dist/bundle.js"></script>
</body>

</html>
```
安装Babel:
```shell
npm install --save-dev @babel/core@7.1.0 @babel/cli@7.1.0 @babel/preset-env@7.1.0 @babel/preset-react@7.0.0
```
> babel-core is the main babel package — We need this for babel to do any transformations on our code. babel-cli allows you to compile files from the command line. preset-react and preset-env are both presets that transform specific flavors of code — in this case, the env preset allows us to transform ES6+ into more traditional javascript and the react preset does the same, but with JSX instead.
> 
> babel-core是主要的babel包，我们需要它来为我们的代码做一些转义工作。babel-cli允许你通过命令行来编译文件。preset-react和preset-env都是为了转换特定风格代码的预设。在这个例子中，env预设允许我们将ES6+转换为传统的JavaScript，react预设也可以做同样的事情，但是是对JSX文件。

在根目录，创建`.babelrc`。
为了告诉Babel我们将使用env和react预设。
```json
{
  "presets": ["@babel/env", "@babel/preset-react"]
}
```

安装webpack:

```shell
npm install --save-dev webpack@4.19.1 webpack-cli@3.1.1 webpack-dev-server@3.1.8 style-loader@0.23.0 css-loader@1.0.0 babel-loader@8.0.2
```
创建文件`webpack.config.js`:
```js
const path = require("path");
const webpack = require("webpack");

module.exports = {
  entry: "./src/index.js",
  mode: "development",
  module: {
    rules: [
      {
        test: /\.(js|jsx)$/,
        exclude: /(node_modules|bower_components)/,
        loader: "babel-loader",
        options: { presets: ["@babel/env"] }
      },
      {
        test: /\.css$/,
        use: ["style-loader", "css-loader"]
      }
    ]
  },
  resolve: { extensions: ["*", ".js", ".jsx"] },
  output: {
    path: path.resolve(__dirname, "dist/"),
    publicPath: "/dist/",
    filename: "bundle.js"
  },
  devServer: {
    contentBase: path.join(__dirname, "public/"),
    port: 3000,
    publicPath: "http://localhost:3000/dist/",
    hotOnly: true
  },
  plugins: [new webpack.HotModuleReplacementPlugin()]
};
```
其中:
- entry: 指定了应用从哪里启动，以及从哪里绑定程序。
- mode: 让webpack知道我们正在开发模式下工作 —— 这使我们不必在运行开发服务器时添加模式标志。
- module: 模块对象有助于定义如何转换导出的 javascript 模块以及根据给定的规则数组包含哪些模块。
    - 我们的第一条规则是关于转换我们的 ES6 和 JSX 语法。test 和 exclude 属性是匹配文件的条件。在这种情况下，它将匹配 node_modules 和 bower_components 目录之外的任何内容。由于我们还将转换 .js 和 .jsx 文件，因此我们需要指示 Webpack 使用 Babel。最后，我们指定我们要在 options 中使用 env 预设。
    - 下一条规则用于处理 CSS。由于我们没有对 CSS 进行预处理或后处理，因此我们只需要确保将 style-loader 和 css-loader 添加到 use 属性。 css-loader 需要 style-loader 才能工作。 loader 是 use 属性的简写，当只使用一个 loader 时。
- resolve: resolve 属性允许我们指定 Webpack 将解析哪些扩展——这允许我们导入模块而不需要添加它们的扩展。
- output: output 属性告诉 Webpack 将我们的捆绑代码放在哪里。 publicPath 属性指定捆绑包应该进入的目录，并告诉 webpack-dev-server 从哪里提供文件。
- publicPath: publicPath 属性是一个特殊的属性，可以帮助我们使用我们的开发服务器。它指定了目录的公共 URL——至少在 webpack-dev-server 知道或关心的范围内。如果设置不正确，您将得到 404，因为服务器不会从正确的位置提供您的文件！
- devServer: 我们在 devServer 属性中设置了 webpack-dev-server。这对我们的需求不需要太多——只需要我们提供静态文件的位置（例如我们的 index.html）和我们想要运行服务器的端口。请注意，devServer 也有一个 publicPath 属性。这个 publicPath 告诉服务器我们的捆绑代码实际在哪里。
- plugins: 最后，由于我们想使用热模块替换，所以我们不必经常刷新来查看我们的更改。我们为此文件所做的就是在 plugins 属性中实例化一个新的插件实例，并确保我们在 devServer 中将 hotOnly 设置为 true。

> 最后一点可能有点令人困惑——这里要特别注意：output.publicPath 和 devServer.publicPath 是不同的。阅读两个条目。两次。


安装React:
```
"dependencies": {
  "react": "16.5.2",
  "react-dom": "16.5.2"
},
```

src目录下创建`index.js`文件:
```js
import React from "react";
import ReactDOM from "react-dom";
import App from "./App.js";
ReactDOM.render(<App />, document.getElementById("root"));
```

src下创建`App.js`文件:
```js
import React, { Component} from "react";
import "./App.css";

class App extends Component{
  render(){
    return(
      <div className="App">
        <h1> Hello, World! </h1>
      </div>
    );
  }
}

export default App;
```
src下创建`App.css`文件:
```css
.App {
    margin: 1rem;
    font-family: Arial, Helvetica, sans-serif;
}
```

现在可以使用`webpack-dev-server --mode development`来启动应用了。

在localhost:3000访问。

## 3. 增加热更新
增加新的依赖:
```json
"dependencies": {
  ...
  "react-hot-loader": "^4.3.11"
},
```
修改App.js为:
```js
import React, { Component} from "react";
import { hot } from "react-hot-loader";
import "./App.css";

class App extends Component{
  render(){
    return(
      <div className="App">
        <h1> Hello, World! </h1>
      </div>
    );
  }
}

export default hot(module)(App);
```

## 4. 增加build脚本
在package.json里面增加:
```json
"scripts": {
  ...
  "build": "webpack --mode development",
  ...
},
```
